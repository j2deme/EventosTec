<!-- app/templates/admin/partials/attendances_student.html -->
<div x-data="attendancesStudent()" x-init="init()" class="max-w-4xl mx-auto">
  <div class="bg-white p-4 rounded shadow mb-4">
    <h2 class="text-lg font-semibold">Gestión de asistencias por estudiante</h2>
    <p class="text-sm text-gray-600">
      Busca un estudiante y edita sus preregistros / asistencias.
    </p>
  </div>

  <div class="bg-white p-4 rounded shadow mb-4">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
      <div class="md:col-span-2">
        <label class="block text-sm font-medium text-gray-700"
          >Buscar estudiante</label
        >
        <input
          x-model="query"
          @keydown.enter.prevent="searchStudent()"
          class="mt-1 block w-full rounded-md border-gray-300"
          placeholder="Número de control o nombre"
        />
      </div>
      <div class="flex items-end">
        <button
          @click="searchStudent()"
          class="px-4 py-2 bg-indigo-600 text-white rounded"
        >
          Buscar
        </button>
      </div>
    </div>
  </div>

  <div class="bg-white p-4 rounded shadow">
    <div x-show="loading" class="py-8 text-center">Buscando...</div>

    <template x-if="student">
      <div>
        <h3 class="text-md font-semibold">
          Resultados para:
          <span x-text="student.full_name || student.name"></span> —
          <small x-text="student.control_number"></small>
        </h3>
        <div class="mt-3">
          <h4 class="font-medium">Preregistros</h4>
          <div class="mt-2">
            <template x-for="reg in registrations" :key="reg.id">
              <div
                class="p-2 border rounded mb-2 flex items-center justify-between"
              >
                <div>
                  <div
                    class="font-medium"
                    x-text="reg.activity?.name || reg.activity_id"
                  ></div>
                  <div
                    class="text-sm text-gray-500"
                    x-text="reg.activity?.event?.name || ''"
                  ></div>
                </div>
                <div class="flex items-center space-x-2">
                  <select
                    x-model="reg.status"
                    @change="updateRegistration(reg)"
                    class="rounded border-gray-300"
                  >
                    <option value="Registrado">Registrado</option>
                    <option value="Confirmado">Confirmado</option>
                    <option value="Asistió">Asistió</option>
                    <option value="Ausente">Ausente</option>
                    <option value="Cancelado">Cancelado</option>
                  </select>
                  <button
                    @click="markAttendance(reg)"
                    class="px-3 py-1 bg-green-600 text-white rounded text-sm"
                  >
                    Marcar Asistencia
                  </button>
                </div>
              </div>
            </template>

            <div x-show="registrations.length === 0" class="py-6 text-gray-500">
              No se encontraron preregistros para este estudiante.
            </div>
          </div>
        </div>
      </div>
    </template>
  </div>

  {#
  <script src="{{ url_for('static', filename='js/admin/attendances_student.js') }}"></script>
  #}
</div>
