{% extends 'base.html' %} {% block content %}
<div x-data="attendancesList()" x-cloak class="p-4">
  <h2 class="text-xl font-bold mb-4">Listado global de asistencias</h2>
  <form class="flex gap-4 mb-4">
    <div>
      <label class="block font-semibold">Evento</label>
      <select
        x-model="selectedEvent"
        @change="loadActivities"
        class="border rounded px-2 py-1"
      >
        <option value="">Todos</option>
        <template x-for="event in events" :key="event.id">
          <option :value="event.id" x-text="event.name"></option>
        </template>
      </select>
    </div>
    <div>
      <label class="block font-semibold">Actividad</label>
      <select x-model="selectedActivity" class="border rounded px-2 py-1">
        <option value="">Todas</option>
        <template x-for="activity in activities" :key="activity.id">
          <option :value="activity.id" x-text="activity.name"></option>
        </template>
      </select>
    </div>
    <div>
      <label class="block font-semibold">Estudiante</label>
      <input
        type="text"
        x-model="studentQuery"
        @input="searchStudents"
        placeholder="Buscar estudiante..."
        class="border rounded px-2 py-1"
        autocomplete="off"
      />
      <div
        class="bg-white border rounded shadow mt-1"
        x-show="studentResults.length"
      >
        <template x-for="student in studentResults" :key="student.id">
          <div
            @click="selectStudent(student)"
            class="px-2 py-1 cursor-pointer hover:bg-blue-100"
            x-text="student.full_name"
          ></div>
        </template>
      </div>
    </div>
    <button
      type="button"
      @click="clearFilters"
      class="bg-gray-300 px-2 py-1 rounded"
    >
      Limpiar
    </button>
  </form>
  <div class="overflow-x-auto">
    <table class="min-w-full border">
      <thead>
        <tr class="bg-gray-100">
          <th class="px-2 py-1 border">Estudiante</th>
          <th class="px-2 py-1 border">Actividad</th>
          <th class="px-2 py-1 border">Evento</th>
          <th class="px-2 py-1 border">Fecha</th>
          <th class="px-2 py-1 border">Estatus</th>
        </tr>
      </thead>
      <tbody>
        <template x-for="att in attendances" :key="att.id">
          <tr>
            <td class="border px-2 py-1" x-text="att.student_name"></td>
            <td class="border px-2 py-1" x-text="att.activity_name"></td>
            <td class="border px-2 py-1" x-text="att.event_name"></td>
            <td class="border px-2 py-1" x-text="att.date"></td>
            <td class="border px-2 py-1" x-text="att.status"></td>
          </tr>
        </template>
        <tr x-show="attendances.length === 0">
          <td colspan="5" class="text-center py-2">
            No hay asistencias encontradas.
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
