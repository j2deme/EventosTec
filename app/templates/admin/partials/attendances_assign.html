{% extends 'base.html' %} {% block content %}
<div x-data="attendancesAssign()" x-cloak class="p-4">
  <h2 class="text-xl font-bold mb-4">Asignar asistencia manual</h2>
  <form @submit.prevent="submitAssign">
    <div class="mb-2">
      <label class="block font-semibold">Evento</label>
      <select
        x-model="selectedEvent"
        @change="loadActivities"
        class="border rounded px-2 py-1 w-full"
      >
        <option value="">Selecciona evento</option>
        <template x-for="(event, idx) in events" :key="event.id ?? idx">
          <option :value="event.id" x-text="event.name"></option>
        </template>
      </select>
    </div>
    <div class="mb-2" x-show="selectedEvent">
      <label class="block font-semibold">Actividad</label>
      <select
        x-model="selectedActivity"
        class="border rounded px-2 py-1 w-full"
      >
        <option value="">Selecciona actividad</option>
        <template
          x-for="(activity, idx) in activities"
          :key="activity.id ?? idx"
        >
          <option :value="activity.id" x-text="activity.name"></option>
        </template>
      </select>
    </div>
    <div class="mb-2" x-show="selectedActivity">
      <label class="block font-semibold">Estudiante</label>
      <input
        type="text"
        x-model="studentQuery"
        @input="searchStudents"
        placeholder="Buscar estudiante..."
        class="border rounded px-2 py-1 w-full"
        autocomplete="off"
      />
      <div
        class="bg-white border rounded shadow mt-1"
        x-show="studentResults.length"
      >
        <template
          x-for="(student, idx) in studentResults"
          :key="student.id ?? idx"
        >
          <div
            @click="selectStudent(student)"
            class="px-2 py-1 cursor-pointer hover:bg-blue-100"
            x-text="student.full_name"
          ></div>
        </template>
      </div>
    </div>
    <div class="mb-2" x-show="selectedStudent">
      <span class="font-semibold">Estudiante seleccionado:</span>
      <span
        x-text="selectedStudent ? selectedStudent.full_name : ''"
        class="ml-2"
      ></span>
    </div>
    <button
      type="submit"
      class="bg-blue-600 text-white px-4 py-2 rounded mt-2"
      :disabled="!selectedActivity || !selectedStudent"
    >
      Asignar asistencia
    </button>
    <div x-show="message" class="mt-2 text-green-600" x-text="message"></div>
    <div x-show="error" class="mt-2 text-red-600" x-text="error"></div>
  </form>
</div>
{% endblock %}
